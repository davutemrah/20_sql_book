<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Sample Solutions | SQL BOOK</title>
  <meta name="description" content="These are my SQL notes to my-self" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Sample Solutions | SQL BOOK" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These are my SQL notes to my-self" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Sample Solutions | SQL BOOK" />
  
  <meta name="twitter:description" content="These are my SQL notes to my-self" />
  

<meta name="author" content="Davut Ayan" />


<meta name="date" content="2024-08-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="coding-can-you-provide-the-solutions-to-a-using-python-or-r.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistics and Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Acknowledgement</a></li>
<li class="chapter" data-level="1" data-path="joins.html"><a href="joins.html"><i class="fa fa-check"></i><b>1</b> joins</a>
<ul>
<li class="chapter" data-level="1.1" data-path="joins.html"><a href="joins.html#joining"><i class="fa fa-check"></i><b>1.1</b> joining</a></li>
<li class="chapter" data-level="1.2" data-path="joins.html"><a href="joins.html#set-operations"><i class="fa fa-check"></i><b>1.2</b> Set Operations</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="joins.html"><a href="joins.html#union-operator"><i class="fa fa-check"></i><b>1.2.1</b> <code>UNION</code> Operator</a></li>
<li class="chapter" data-level="1.2.2" data-path="joins.html"><a href="joins.html#union-all-operator"><i class="fa fa-check"></i><b>1.2.2</b> <code>UNION ALL</code> Operator</a></li>
<li class="chapter" data-level="1.2.3" data-path="joins.html"><a href="joins.html#intersect-operator"><i class="fa fa-check"></i><b>1.2.3</b> <code>INTERSECT</code> Operator</a></li>
<li class="chapter" data-level="1.2.4" data-path="joins.html"><a href="joins.html#minus-or-except-operator"><i class="fa fa-check"></i><b>1.2.4</b> <code>MINUS</code> (or <code>EXCEPT</code>) Operator</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#order-of-execution"><i class="fa fa-check"></i><b>2.1</b> Order of Execution</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="creatind-tables.html"><a href="creatind-tables.html"><i class="fa fa-check"></i><b>3</b> Creatind Tables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="creatind-tables.html"><a href="creatind-tables.html#date-functions"><i class="fa fa-check"></i><b>3.1</b> Date Functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="filtering.html"><a href="filtering.html"><i class="fa fa-check"></i><b>4</b> FILTERING</a>
<ul>
<li class="chapter" data-level="4.1" data-path="filtering.html"><a href="filtering.html#wildcards"><i class="fa fa-check"></i><b>4.1</b> Wildcards</a></li>
<li class="chapter" data-level="4.2" data-path="filtering.html"><a href="filtering.html#distinct-keyword"><i class="fa fa-check"></i><b>4.2</b> DISTINCT keyword</a></li>
<li class="chapter" data-level="4.3" data-path="filtering.html"><a href="filtering.html#advanced-filtering"><i class="fa fa-check"></i><b>4.3</b> Advanced Filtering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="filtering.html"><a href="filtering.html#having-clause"><i class="fa fa-check"></i><b>4.3.1</b> <code>HAVING</code> Clause</a></li>
<li class="chapter" data-level="4.3.2" data-path="filtering.html"><a href="filtering.html#qualify-clause"><i class="fa fa-check"></i><b>4.3.2</b> <code>QUALIFY</code> Clause</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="most-used-functions.html"><a href="most-used-functions.html"><i class="fa fa-check"></i><b>5</b> MOST USED FUNCTIONS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="most-used-functions.html"><a href="most-used-functions.html#string-functions"><i class="fa fa-check"></i><b>5.1</b> string functions</a></li>
<li class="chapter" data-level="5.2" data-path="most-used-functions.html"><a href="most-used-functions.html#aggregate-functions"><i class="fa fa-check"></i><b>5.2</b> Aggregate Functions:</a></li>
<li class="chapter" data-level="5.3" data-path="most-used-functions.html"><a href="most-used-functions.html#non-aggregate-functions"><i class="fa fa-check"></i><b>5.3</b> Non-Aggregate Functions:</a></li>
<li class="chapter" data-level="5.4" data-path="most-used-functions.html"><a href="most-used-functions.html#window-functions"><i class="fa fa-check"></i><b>5.4</b> Window Functions</a></li>
<li class="chapter" data-level="5.5" data-path="most-used-functions.html"><a href="most-used-functions.html#functions-comparing-columns"><i class="fa fa-check"></i><b>5.5</b> Functions comparing columns:</a></li>
<li class="chapter" data-level="5.6" data-path="most-used-functions.html"><a href="most-used-functions.html#some-advanced-functions"><i class="fa fa-check"></i><b>5.6</b> Some Advanced Functions</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="most-used-functions.html"><a href="most-used-functions.html#listagg"><i class="fa fa-check"></i><b>5.6.1</b> LISTAGG</a></li>
<li class="chapter" data-level="5.6.2" data-path="most-used-functions.html"><a href="most-used-functions.html#lateral"><i class="fa fa-check"></i><b>5.6.2</b> LATERAL</a></li>
<li class="chapter" data-level="5.6.3" data-path="most-used-functions.html"><a href="most-used-functions.html#update"><i class="fa fa-check"></i><b>5.6.3</b> UPDATE</a></li>
<li class="chapter" data-level="5.6.4" data-path="most-used-functions.html"><a href="most-used-functions.html#alter"><i class="fa fa-check"></i><b>5.6.4</b> ALTER</a></li>
<li class="chapter" data-level="5.6.5" data-path="most-used-functions.html"><a href="most-used-functions.html#delete-rows"><i class="fa fa-check"></i><b>5.6.5</b> DELETE ROWS</a></li>
<li class="chapter" data-level="5.6.6" data-path="most-used-functions.html"><a href="most-used-functions.html#insert"><i class="fa fa-check"></i><b>5.6.6</b> INSERT</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html"><i class="fa fa-check"></i><b>6</b> Adhoc solutions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#data-qa-efforts"><i class="fa fa-check"></i><b>6.1</b> DATA QA EFFORTS</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#counts"><i class="fa fa-check"></i><b>6.1.1</b> COUNTS</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#balancing-weights"><i class="fa fa-check"></i><b>6.2</b> Balancing Weights</a></li>
<li class="chapter" data-level="6.3" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#weighted-sampling"><i class="fa fa-check"></i><b>6.3</b> Weighted Sampling</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#solution"><i class="fa fa-check"></i><b>6.3.1</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#demographic-distribution"><i class="fa fa-check"></i><b>6.4</b> Demographic Distribution</a></li>
<li class="chapter" data-level="6.5" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#risky-projects"><i class="fa fa-check"></i><b>6.5</b> Risky Projects</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#tables"><i class="fa fa-check"></i><b>6.5.1</b> tables</a></li>
<li class="chapter" data-level="6.5.2" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#solution-1"><i class="fa fa-check"></i><b>6.5.2</b> SOLUTION 1</a></li>
<li class="chapter" data-level="6.5.3" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#soultion-2"><i class="fa fa-check"></i><b>6.5.3</b> SOULTION 2</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="adhoc-solutions.html"><a href="adhoc-solutions.html#how-many-users-have-applied-to-the-same-companies-they-have-applied-before-the-past-year"><i class="fa fa-check"></i><b>6.6</b> How many users have applied to the same companies they have applied before the past year?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="coding-can-you-provide-the-solutions-to-a-using-python-or-r.html"><a href="coding-can-you-provide-the-solutions-to-a-using-python-or-r.html"><i class="fa fa-check"></i><b>7</b> [Coding] Can you provide the solutions to (A) using Python or R?</a></li>
<li class="chapter" data-level="8" data-path="sample-solutions.html"><a href="sample-solutions.html"><i class="fa fa-check"></i><b>8</b> Sample Solutions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sample-solutions.html"><a href="sample-solutions.html#datalemur-20-solved-sql"><i class="fa fa-check"></i><b>8.1</b> Datalemur 20 Solved SQL</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="sample-solutions.html"><a href="sample-solutions.html#repeated-transactions"><i class="fa fa-check"></i><b>8.1.1</b> Repeated transactions</a></li>
<li class="chapter" data-level="8.1.2" data-path="sample-solutions.html"><a href="sample-solutions.html#describe-how-recursive-queries-work-in-sql."><i class="fa fa-check"></i><b>8.1.2</b> Describe how recursive queries work in SQL.</a></li>
<li class="chapter" data-level="8.1.3" data-path="sample-solutions.html"><a href="sample-solutions.html#median-google-search-frequency"><i class="fa fa-check"></i><b>8.1.3</b> Median Google Search Frequency</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://davutemrah.github.io" target="blank">Back to Home Page</li>
<li><a href="https://davutemrah.github.io/notebooks/" target="blank">Back to Collections</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SQL BOOK</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sample-solutions" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Sample Solutions<a href="sample-solutions.html#sample-solutions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="datalemur-20-solved-sql" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Datalemur 20 Solved SQL<a href="sample-solutions.html#datalemur-20-solved-sql" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="repeated-transactions" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Repeated transactions<a href="sample-solutions.html#repeated-transactions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes, payment transactions are repeated by accident; it could be due to user error, API failure or a retry error that causes a credit card to be charged twice.</p>
<p>Using the transactions table, identify any payments made at the same merchant with the same credit card for the same amount within 10 minutes of each other. Count such repeated payments.</p>
<p>Assumptions:</p>
<p>The first transaction of such payments should not be counted as a repeated payment. This means, if there are two transactions performed by a merchant with the same credit card and for the same amount within 10 minutes, there will only be 1 repeated payment.</p>
<p><strong>Solution for PostgreSQL 14</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb38-1"><a href="sample-solutions.html#cb38-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb38-2"><a href="sample-solutions.html#cb38-2" tabindex="-1"></a><span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> A.transaction_id) <span class="kw">AS</span> PAYMENT_COUNT</span>
<span id="cb38-3"><a href="sample-solutions.html#cb38-3" tabindex="-1"></a><span class="kw">FROM</span> transactions A</span>
<span id="cb38-4"><a href="sample-solutions.html#cb38-4" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> transactions B </span>
<span id="cb38-5"><a href="sample-solutions.html#cb38-5" tabindex="-1"></a>  <span class="kw">ON</span> A.merchant_id<span class="op">=</span>B.merchant_id</span>
<span id="cb38-6"><a href="sample-solutions.html#cb38-6" tabindex="-1"></a>  <span class="kw">AND</span> A.credit_card_id<span class="op">=</span>B.credit_card_id</span>
<span id="cb38-7"><a href="sample-solutions.html#cb38-7" tabindex="-1"></a>  <span class="kw">AND</span> A.AMOUNT<span class="op">=</span>B.AMOUNT</span>
<span id="cb38-8"><a href="sample-solutions.html#cb38-8" tabindex="-1"></a><span class="kw">WHERE</span> <span class="fu">EXTRACT</span>(EPOCH <span class="kw">FROM</span> (A.transaction_timestamp <span class="op">-</span> B.transaction_timestamp))<span class="op">/</span><span class="dv">60</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb38-9"><a href="sample-solutions.html#cb38-9" tabindex="-1"></a>  <span class="kw">AND</span> <span class="fu">EXTRACT</span>(EPOCH <span class="kw">FROM</span> (A.transaction_timestamp <span class="op">-</span> B.transaction_timestamp))<span class="op">/</span><span class="dv">60</span> <span class="op">&lt;=</span> <span class="dv">10</span></span></code></pre></div>
<p><strong>Alternative solution in SNOWFLAKE</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="sample-solutions.html#cb39-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb39-2"><a href="sample-solutions.html#cb39-2" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> A.transaction_id) <span class="kw">AS</span> PAYMENT_COUNT</span>
<span id="cb39-3"><a href="sample-solutions.html#cb39-3" tabindex="-1"></a><span class="kw">FROM</span> transactions A</span>
<span id="cb39-4"><a href="sample-solutions.html#cb39-4" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> transactions B </span>
<span id="cb39-5"><a href="sample-solutions.html#cb39-5" tabindex="-1"></a>    <span class="kw">ON</span> A.merchant_id <span class="op">=</span> B.merchant_id</span>
<span id="cb39-6"><a href="sample-solutions.html#cb39-6" tabindex="-1"></a>    <span class="kw">AND</span> A.credit_card_id <span class="op">=</span> B.credit_card_id</span>
<span id="cb39-7"><a href="sample-solutions.html#cb39-7" tabindex="-1"></a>    <span class="kw">AND</span> A.AMOUNT <span class="op">=</span> B.AMOUNT</span>
<span id="cb39-8"><a href="sample-solutions.html#cb39-8" tabindex="-1"></a>    <span class="kw">AND</span> A.transaction_id <span class="op">!=</span> B.transaction_id</span>
<span id="cb39-9"><a href="sample-solutions.html#cb39-9" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb39-10"><a href="sample-solutions.html#cb39-10" tabindex="-1"></a>    DATEDIFF(<span class="kw">minute</span>, B.transaction_timestamp, A.transaction_timestamp) <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb39-11"><a href="sample-solutions.html#cb39-11" tabindex="-1"></a>    <span class="kw">AND</span> DATEDIFF(<span class="kw">minute</span>, B.transaction_timestamp, A.transaction_timestamp) <span class="op">&lt;=</span> <span class="dv">10</span>;</span></code></pre></div>
<p><strong>Using LAG() window function</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb40-1"><a href="sample-solutions.html#cb40-1" tabindex="-1"></a><span class="kw">WITH</span> payments <span class="kw">AS</span> (</span>
<span id="cb40-2"><a href="sample-solutions.html#cb40-2" tabindex="-1"></a>  <span class="kw">SELECT</span> </span>
<span id="cb40-3"><a href="sample-solutions.html#cb40-3" tabindex="-1"></a>    merchant_id, </span>
<span id="cb40-4"><a href="sample-solutions.html#cb40-4" tabindex="-1"></a>    <span class="fu">EXTRACT</span>(EPOCH <span class="kw">FROM</span> transaction_timestamp <span class="op">-</span> </span>
<span id="cb40-5"><a href="sample-solutions.html#cb40-5" tabindex="-1"></a>      <span class="fu">LAG</span>(transaction_timestamp) <span class="kw">OVER</span>(</span>
<span id="cb40-6"><a href="sample-solutions.html#cb40-6" tabindex="-1"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> merchant_id, credit_card_id, amount </span>
<span id="cb40-7"><a href="sample-solutions.html#cb40-7" tabindex="-1"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> transaction_timestamp)</span>
<span id="cb40-8"><a href="sample-solutions.html#cb40-8" tabindex="-1"></a>    )<span class="op">/</span><span class="dv">60</span> <span class="kw">AS</span> minute_difference </span>
<span id="cb40-9"><a href="sample-solutions.html#cb40-9" tabindex="-1"></a>  <span class="kw">FROM</span> transactions</span>
<span id="cb40-10"><a href="sample-solutions.html#cb40-10" tabindex="-1"></a>) </span>
<span id="cb40-11"><a href="sample-solutions.html#cb40-11" tabindex="-1"></a></span>
<span id="cb40-12"><a href="sample-solutions.html#cb40-12" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(merchant_id) <span class="kw">AS</span> payment_count</span>
<span id="cb40-13"><a href="sample-solutions.html#cb40-13" tabindex="-1"></a><span class="kw">FROM</span> payments </span>
<span id="cb40-14"><a href="sample-solutions.html#cb40-14" tabindex="-1"></a><span class="kw">WHERE</span> minute_difference <span class="op">&lt;=</span> <span class="dv">10</span>;</span></code></pre></div>
</div>
<div id="describe-how-recursive-queries-work-in-sql." class="section level3 hasAnchor" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Describe how recursive queries work in SQL.<a href="sample-solutions.html#describe-how-recursive-queries-work-in-sql." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Provide an example scenario where a recursive query would be beneficial.</p>
<p>Recursive queries in SQL enable iteration over hierarchical data structures like organizational charts, bill-of-materials, or nested comments. For example, you could use a recursive query to traverse a hierarchical data structure and retrieve all descendants of a specific node.</p>
<p>Scenario: Organizational Hierarchy Reporting</p>
<p>Imagine you have an employee table in a database that stores information about employees and their reporting structure in a large company. The table includes an EmployeeID, EmployeeName, and ManagerID, where ManagerID is a reference to another EmployeeID, indicating who the manager is for that employee.</p>
<p>Objective:
You need to generate a report that lists all employees under a specific manager, including all levels of the hierarchy (i.e., the manager’s direct reports, the direct reports of those direct reports, and so on).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb41-1"><a href="sample-solutions.html#cb41-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> Employees (</span>
<span id="cb41-2"><a href="sample-solutions.html#cb41-2" tabindex="-1"></a>    EmployeeID <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb41-3"><a href="sample-solutions.html#cb41-3" tabindex="-1"></a>    EmployeeName <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb41-4"><a href="sample-solutions.html#cb41-4" tabindex="-1"></a>    ManagerID <span class="dt">INT</span> <span class="co">-- This references EmployeeID in the same table</span></span>
<span id="cb41-5"><a href="sample-solutions.html#cb41-5" tabindex="-1"></a>);</span></code></pre></div>
<p>Sample Data</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb42-1"><a href="sample-solutions.html#cb42-1" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> Employees (EmployeeID, EmployeeName, ManagerID)</span>
<span id="cb42-2"><a href="sample-solutions.html#cb42-2" tabindex="-1"></a><span class="kw">VALUES</span> </span>
<span id="cb42-3"><a href="sample-solutions.html#cb42-3" tabindex="-1"></a>(<span class="dv">1</span>, <span class="st">&#39;Alice&#39;</span>, <span class="kw">NULL</span>),      <span class="co">-- Alice is the CEO, no manager</span></span>
<span id="cb42-4"><a href="sample-solutions.html#cb42-4" tabindex="-1"></a>(<span class="dv">2</span>, <span class="st">&#39;Bob&#39;</span>, <span class="dv">1</span>),           <span class="co">-- Bob reports to Alice</span></span>
<span id="cb42-5"><a href="sample-solutions.html#cb42-5" tabindex="-1"></a>(<span class="dv">3</span>, <span class="st">&#39;Charlie&#39;</span>, <span class="dv">2</span>),       <span class="co">-- Charlie reports to Bob</span></span>
<span id="cb42-6"><a href="sample-solutions.html#cb42-6" tabindex="-1"></a>(<span class="dv">4</span>, <span class="st">&#39;David&#39;</span>, <span class="dv">2</span>),         <span class="co">-- David reports to Bob</span></span>
<span id="cb42-7"><a href="sample-solutions.html#cb42-7" tabindex="-1"></a>(<span class="dv">5</span>, <span class="st">&#39;Eve&#39;</span>, <span class="dv">3</span>),           <span class="co">-- Eve reports to Charlie</span></span>
<span id="cb42-8"><a href="sample-solutions.html#cb42-8" tabindex="-1"></a>(<span class="dv">6</span>, <span class="st">&#39;Frank&#39;</span>, <span class="dv">3</span>);         <span class="co">-- Frank reports to Charlie</span></span></code></pre></div>
<div id="recursive-query-example" class="section level4 hasAnchor" number="8.1.2.1">
<h4><span class="header-section-number">8.1.2.1</span> Recursive Query Example:<a href="sample-solutions.html#recursive-query-example" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To retrieve the entire hierarchy under Bob (EmployeeID = 2):</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb43-1"><a href="sample-solutions.html#cb43-1" tabindex="-1"></a><span class="kw">WITH</span> RECURSIVE EmployeeHierarchy <span class="kw">AS</span> (</span>
<span id="cb43-2"><a href="sample-solutions.html#cb43-2" tabindex="-1"></a>    <span class="co">-- Anchor member: Start with the manager (Bob)</span></span>
<span id="cb43-3"><a href="sample-solutions.html#cb43-3" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb43-4"><a href="sample-solutions.html#cb43-4" tabindex="-1"></a>        EmployeeID, </span>
<span id="cb43-5"><a href="sample-solutions.html#cb43-5" tabindex="-1"></a>        EmployeeName, </span>
<span id="cb43-6"><a href="sample-solutions.html#cb43-6" tabindex="-1"></a>        ManagerID</span>
<span id="cb43-7"><a href="sample-solutions.html#cb43-7" tabindex="-1"></a>    <span class="kw">FROM</span> Employees</span>
<span id="cb43-8"><a href="sample-solutions.html#cb43-8" tabindex="-1"></a>    <span class="kw">WHERE</span> EmployeeID <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb43-9"><a href="sample-solutions.html#cb43-9" tabindex="-1"></a></span>
<span id="cb43-10"><a href="sample-solutions.html#cb43-10" tabindex="-1"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb43-11"><a href="sample-solutions.html#cb43-11" tabindex="-1"></a></span>
<span id="cb43-12"><a href="sample-solutions.html#cb43-12" tabindex="-1"></a>    <span class="co">-- Recursive member: Retrieve all employees who report to the current level of employees</span></span>
<span id="cb43-13"><a href="sample-solutions.html#cb43-13" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb43-14"><a href="sample-solutions.html#cb43-14" tabindex="-1"></a>        e.EmployeeID, </span>
<span id="cb43-15"><a href="sample-solutions.html#cb43-15" tabindex="-1"></a>        e.EmployeeName, </span>
<span id="cb43-16"><a href="sample-solutions.html#cb43-16" tabindex="-1"></a>        e.ManagerID</span>
<span id="cb43-17"><a href="sample-solutions.html#cb43-17" tabindex="-1"></a>    <span class="kw">FROM</span> Employees e</span>
<span id="cb43-18"><a href="sample-solutions.html#cb43-18" tabindex="-1"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> EmployeeHierarchy eh <span class="kw">ON</span> e.ManagerID <span class="op">=</span> eh.EmployeeID</span>
<span id="cb43-19"><a href="sample-solutions.html#cb43-19" tabindex="-1"></a>)</span>
<span id="cb43-20"><a href="sample-solutions.html#cb43-20" tabindex="-1"></a></span>
<span id="cb43-21"><a href="sample-solutions.html#cb43-21" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb43-22"><a href="sample-solutions.html#cb43-22" tabindex="-1"></a>    EmployeeID, </span>
<span id="cb43-23"><a href="sample-solutions.html#cb43-23" tabindex="-1"></a>    EmployeeName, </span>
<span id="cb43-24"><a href="sample-solutions.html#cb43-24" tabindex="-1"></a>    ManagerID</span>
<span id="cb43-25"><a href="sample-solutions.html#cb43-25" tabindex="-1"></a><span class="kw">FROM</span> EmployeeHierarchy;</span></code></pre></div>
<p><strong>Why Use a Recursive Query Here?</strong></p>
<p>The recursive query effectively traverses the hierarchy and retrieves all descendants of a specific manager. This approach is scalable and adaptable to varying levels of hierarchy depth, which would be challenging to achieve with a non-recursive query.</p>
</div>
</div>
<div id="median-google-search-frequency" class="section level3 hasAnchor" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Median Google Search Frequency<a href="sample-solutions.html#median-google-search-frequency" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Google’s marketing team is making a Superbowl commercial and needs a simple statistic to put on their TV ad: the median number of searches a person made last year.</p>
<p>However, at Google scale, querying the 2 trillion searches is too costly. Luckily, you have access to the summary table which tells you the number of searches made last year and how many Google users fall into that bucket.</p>
<p>Write a query to report the median of searches made by a user. Round the median to one decimal point.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="coding-can-you-provide-the-solutions-to-a-using-python-or-r.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Statistics.pdf", "Statistics.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
